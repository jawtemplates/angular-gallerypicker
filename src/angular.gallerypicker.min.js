(function(c,a,d){var b=a.module("jaw.gallerypicker",[]);b.directive("gallerypicker",function(){return{require:"?ngModel",replace:true,transclude:false,scope:{componentPicker:"=ngModel",inputName:"@name"},restrict:"A",template:'<div class="jaw_gallerypicker" ><input type="hidden"  name="{{ inputName }}" ng-model="componentPicker" value="{{ componentPicker }}" /><div class="imgs"><span ng-repeat="(i, images) in componentPicker"><img ng-src="{{images.url}}" /></span></div><div class="button jaw-insert-media add_media" ng-click="edit_gallery()"><i class="icon-plus"></i> Edit gallery</div></div>',link:function(i,h,e,k){if(!k){return}var j=j||new Array();var g=a.element(h.children()[0]);var f="gallery-edit";wp.media.jaw_jaw_gallerypicker={select:function(){var n="";if(!(i.componentPicker==d||i.componentPicker=="")){jQuery.each(i.componentPicker,function(p,q){n+=q.id+", "});var o=wp.shortcode.next("gallery",'[gallery ids="'+n+'" ]'),l,m;if(!o){return}o=o.shortcode;l=wp.media.gallery.attachments(o);m=new wp.media.model.Selection(l.models,{props:l.props.toJSON(),multiple:true});m.gallery=l.gallery;m.more().done(function(){m.props.set({query:false});m.unmirror();m.props.unset("orderby")})}else{m=null}return m},frame:function(){if(i.componentPicker==""){f="gallery-library"}else{if(this._frame&&f=="gallery-library"){f="gallery-edit"}else{if(this._frame){return this._frame}}}var l=this.select();this._frame=wp.media({id:"jaw_jaw_gallerypicker",frame:"post",state:f,title:wp.media.view.l10n.editGalleryTitle,editing:true,multiple:true,selection:l});this._frame.on("update",function(){var m=wp.media.jaw_jaw_gallerypicker._frame.states.get("gallery-edit");var n=m.get("library");var p=n.pluck("id");var q=n.pluck("url");var o=new Array;jQuery.each(p,function(r,s){o.push({id:s,url:q[r]})});g.val(JSON.stringify(o));i.componentPicker=o;i.$apply()});return this._frame},init:function(){i.edit_gallery=function(){wp.media.jaw_jaw_gallerypicker.frame().open()}}};jQuery(wp.media.jaw_jaw_gallerypicker.init)}}})})(window,window.angular);